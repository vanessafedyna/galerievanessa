<!doctype html>
<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Photos (œuvres de la galerie)</title>
    <style>
      :root{
        --bg:#060611;
        --card: rgba(255,255,255,.06);
        --stroke: rgba(255,255,255,.12);
        --text: #fff6ff;
        --muted: rgba(255,255,255,.72);
        --radius: 18px;
      }
      body{
        margin:0;
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
        background: radial-gradient(1000px 600px at 50% 0%, rgba(98,73,172,.20), transparent 60%), var(--bg);
        color: var(--text);
      }
      header{
        max-width: 1100px;
        margin: 0 auto;
        padding: 22px 16px 6px;
      }
      h1{ margin:0 0 6px; font-size: 20px; }
      p{ margin:0; color: var(--muted); font-size: 13px; line-height: 1.4; }
      main{
        max-width: 1100px;
        margin: 0 auto;
        padding: 16px;
      }
      .grid{
        display:grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 14px;
      }
      .card{
        border-radius: var(--radius);
        overflow:hidden;
        background: var(--card);
        border: 1px solid var(--stroke);
        box-shadow: 0 18px 50px rgba(0,0,0,.35);
      }
      .img{
        aspect-ratio: 4/3;
        width: 100%;
        display:block;
        object-fit: cover;
        background: rgba(255,255,255,.04);
      }
      .cap{
        padding: 10px 12px 12px;
      }
      .title{
        font-weight: 750;
        font-size: 13px;
        margin:0 0 2px;
      }
      .meta{
        margin:0;
        font-size: 12px;
        color: var(--muted);
      }
      .pill{
        display:inline-block;
        margin-top: 8px;
        font-size: 12px;
        padding: 6px 10px;
        border-radius: 999px;
        border: 1px solid var(--stroke);
        background: rgba(0,0,0,.18);
        color: var(--muted);
      }
    </style>
  </head>
  <body>
    <header>
      <h1>Photos des œuvres (celles qui ont une image locale)</h1>
      <p>Cette page essaie de lire <code>data/oeuvres.json</code>. Si ça échoue (ex: ouverture en double-clic), elle affiche un fallback.</p>
      <p id="count"></p>
    </header>

    <main>
      <div class="grid" id="grid"></div>
    </main>

    <script>
      const grid = document.getElementById("grid");
      const count = document.getElementById("count");

      const esc = (s) =>
        String(s ?? "")
          .replaceAll("&", "&amp;")
          .replaceAll("<", "&lt;")
          .replaceAll(">", "&gt;")
          .replaceAll('"', "&quot;")
          .replaceAll("'", "&#39;");

      const FALLBACK = [
        { id: "cerce-nacarat", image: "images/cerce-nacarat.jpg" },
        { id: "le-poete-enchante", image: "images/le-poete-enchante.jpg" },
        { id: "composition-en-bleu", image: "images/composition-en-bleu.jpg" },
        { id: "composition-no-17", image: "images/composition-no-17.jpg" },
        { id: "congo", image: "images/congo.jpg" },
        { id: "les-grandes-formes-qui-dansent-champ-de-mars-1968", image: "images/ferron-champ-de-mars.jpg" },
        { id: "untitled-1972-mmfa", image: "images/ferron-mmfa-untitled-1972.jpg" },
        { id: "sans-titre-1979-palais-de-justice-granby", image: "images/ferron-granby.jpg" },
        { id: "verriere-et-sculpture-1979-station-vendome", image: "images/ferron-vendome.jpg" },
        { id: "les-fees-se-drapent", image: "images/les-fees-se-drapent.jpg" },
        { id: "le-champ-russe", image: "images/le-champ-russe.jpg" },
        { id: "le-bolide", image: "images/le-bolide.jpg" },
        { id: "hommage-a-la-musique", image: "images/hommage-a-la-musique.jpg" },
        { id: "l-odalisque", image: "images/l-odalisque.jpg" },
        { id: "etude-no-1", image: "images/etude-no-1.jpg" },
        { id: "sans-titre-71-86", image: "images/sans-titre-71-86.jpg" },
        { id: "a-la-peinture-argentee", image: "images/a-la-peinture-argentee.jpg" },
        { id: "sans-titre-92-625", image: "images/sans-titre-92-625.jpg" },
        { id: "sans-titre-65-109", image: "images/sans-titre-65-109.jpg" }
      ];

      const render = (list, label) => {
        grid.textContent = "";
        count.textContent = `${label} : ${list.length}`;

        list.forEach((o) => {
          const card = document.createElement("article");
          card.className = "card";

          const img = document.createElement("img");
          img.className = "img";
          img.loading = "lazy";
          img.alt = o?.titre ? String(o.titre) : (o?.id ? String(o.id) : "Œuvre");
          img.src = String(new URL(String(o.image).replace(/^\/+/, ""), window.location.href));

          const cap = document.createElement("div");
          cap.className = "cap";
          cap.innerHTML =
            `<p class="title">${esc(o?.titre ?? o?.id ?? "Œuvre")}</p>` +
            `<p class="meta">${esc(o?.annee ?? "")} · ${esc(o?.type ?? "")}</p>` +
            `<span class="pill">${esc(o?.id ?? "")}</span>`;

          card.appendChild(img);
          card.appendChild(cap);
          grid.appendChild(card);
        });
      };

      (async () => {
        try {
          const oeuvresUrl = new URL("data/oeuvres.json", window.location.href);
          const res = await fetch(oeuvresUrl, { cache: "no-store" });
          if (!res.ok) throw new Error(`HTTP ${res.status} sur ${oeuvresUrl}`);

          const oeuvres = await res.json();
          const withImages = Array.isArray(oeuvres)
            ? oeuvres.filter((o) => (o?.image ?? "").trim() !== "")
            : [];

          if (!withImages.length) throw new Error("Aucune image dans oeuvres.json");
          render(withImages, "Photos (liste auto)");
        } catch (err) {
          console.warn("Photos: fallback actif (raison):", err);
          render(FALLBACK, "Photos (fallback)");
        }
      })();
    </script>
  </body>
</html>

